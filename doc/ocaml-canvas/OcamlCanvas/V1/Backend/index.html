<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Backend (ocaml-canvas.OcamlCanvas.V1.Backend)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">ocaml-canvas</a> &#x00BB; <a href="../../index.html">OcamlCanvas</a> &#x00BB; <a href="../index.html">V1</a> &#x00BB; Backend</nav><header class="odoc-preamble"><h1>Module <code><span>V1.Backend</span></code></h1><p>Initialization and event loop control</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-backend_type" class="anchored"><a href="#type-backend_type" class="anchor"></a><code><span><span class="keyword">type</span> <span>_ backend_type</span></span><span> = </span></code><table><tr id="type-backend_type.Canvas" class="anchored"><td class="def variant constructor"><a href="#type-backend_type.Canvas" class="anchor"></a><code><span>| </span><span><span class="constructor">Canvas</span> : <span><span>[ `JS ]</span> <a href="#type-backend_type">backend_type</a></span></span></code></td></tr><tr id="type-backend_type.GDI" class="anchored"><td class="def variant constructor"><a href="#type-backend_type.GDI" class="anchor"></a><code><span>| </span><span><span class="constructor">GDI</span> : <span><span>[ `Win32 ]</span> <a href="#type-backend_type">backend_type</a></span></span></code></td></tr><tr id="type-backend_type.Quartz" class="anchored"><td class="def variant constructor"><a href="#type-backend_type.Quartz" class="anchor"></a><code><span>| </span><span><span class="constructor">Quartz</span> : <span><span>[ `OSX ]</span> <a href="#type-backend_type">backend_type</a></span></span></code></td></tr><tr id="type-backend_type.X11" class="anchored"><td class="def variant constructor"><a href="#type-backend_type.X11" class="anchor"></a><code><span>| </span><span><span class="constructor">X11</span> : <span><span>[&lt; `Unix <span>| `OSX</span> <span>| `Win32</span> ]</span> <a href="#type-backend_type">backend_type</a></span></span></code></td></tr><tr id="type-backend_type.Wayland" class="anchored"><td class="def variant constructor"><a href="#type-backend_type.Wayland" class="anchor"></a><code><span>| </span><span><span class="constructor">Wayland</span> : <span><span>[ `Unix ]</span> <a href="#type-backend_type">backend_type</a></span></span></code></td></tr></table></div><div class="spec-doc"><p>The different kind of supported backends</p></div></div><div class="odoc-spec"><div class="spec type" id="type-options" class="anchored"><a href="#type-options" class="anchor"></a><code><span><span class="keyword">type</span> options</span><span> = </span><span>{</span></code><table><tr id="type-options.js_backends" class="anchored"><td class="def record field"><a href="#type-options.js_backends" class="anchor"></a><code><span>js_backends : <span><span><span>[ `JS ]</span> <a href="#type-backend_type">backend_type</a></span> list</span>;</span></code></td></tr><tr id="type-options.win32_backends" class="anchored"><td class="def record field"><a href="#type-options.win32_backends" class="anchor"></a><code><span>win32_backends : <span><span><span>[ `Win32 ]</span> <a href="#type-backend_type">backend_type</a></span> list</span>;</span></code></td></tr><tr id="type-options.osx_backends" class="anchored"><td class="def record field"><a href="#type-options.osx_backends" class="anchor"></a><code><span>osx_backends : <span><span><span>[ `OSX ]</span> <a href="#type-backend_type">backend_type</a></span> list</span>;</span></code></td></tr><tr id="type-options.unix_backends" class="anchored"><td class="def record field"><a href="#type-options.unix_backends" class="anchor"></a><code><span>unix_backends : <span><span><span>[ `Unix ]</span> <a href="#type-backend_type">backend_type</a></span> list</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>List of available backends per OS</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_options" class="anchored"><a href="#val-default_options" class="anchor"></a><code><span><span class="keyword">val</span> default_options : <a href="#type-options">options</a></span></code></div><div class="spec-doc"><p>The default options to use for backend initialization</p></div></div><div class="odoc-spec"><div class="spec value" id="val-init" class="anchored"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span><a href="#type-options">options</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>init o</code> initializes the backend with the specified options</p></div></div><div class="odoc-spec"><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span>( <span><span class="type-var">'state</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Event/index.html#type-t">Event.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'state</span> * bool )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'state</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'dummy1</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'state</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'dummy2</span></span></code></div><div class="spec-doc"><p><code>run h k s</code> executes the backend event loop, calling the event handler function <code>h</code> when an event occurs, and calling the continuation function <code>k</code> when the event loop terminates, passing the given state <code>s</code> to these functions as needed. The event handler function should return the new state, and a boolean indicating whether the event was actually handled. The backend uses this information to determine whether further actions need to be performed (eg. presenting the contents of a canvas when returning true in a frame event), or whether a default action should be performed (as of now, no default action is performed, but this may change in the future). Simply put, just return true in events you actually handle, and false otherwise. Note that the call to <code>run</code> MUST be the last instruction in your program (to avoid different behaviors between the native and javascript backends). If you need to perform additional stuff when the program terminates, yout MUST use the <code>k</code> function: it is meant for that. Note that calling <code>run</code> from the event handler function <code>h</code> will just be ignored (though this should not be done). However, <code>run</code> may be called from the <code>k</code> function, if needed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-stop" class="anchored"><a href="#val-stop" class="anchor"></a><code><span><span class="keyword">val</span> stop : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>stop ()</code> requests termination of the currently running event loop, if any. It should be called from an event handler function. Actual termination of the event loop will occur at the end of the current iteration of the event loop, so after calling <code>stop</code> an event handler should proceed normally until it returns.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-getCanvas" class="anchored"><a href="#val-getCanvas" class="anchor"></a><code><span><span class="keyword">val</span> getCanvas : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Canvas/index.html#type-t">Canvas.t</a></span> option</span></span></code></div><div class="spec-doc"><p><code>getCanvas i</code> returns the canvas that has id <code>i</code>, if it exists</p></div></div><div class="odoc-spec"><div class="spec value" id="val-getCurrentTimestamp" class="anchored"><a href="#val-getCurrentTimestamp" class="anchor"></a><code><span><span class="keyword">val</span> getCurrentTimestamp : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../Event/index.html#type-timestamp">Event.timestamp</a></span></code></div><div class="spec-doc"><p><code>getCurrentTimestamp ()</code> returns the current timestamp in microseconds, from an arbitrary starting point</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sendCustomEvent" class="anchored"><a href="#val-sendCustomEvent" class="anchor"></a><code><span><span class="keyword">val</span> sendCustomEvent : <span><a href="../Event/index.html#type-payload">Event.payload</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>sendCustomEvent p</code> requests the backend to send a custom event with payload <code>p</code> ; if called within an event handler, this event will be processed after processing of the current event is done. This ensures the state remains consistent accross events.</p></div></div></div></body></html>